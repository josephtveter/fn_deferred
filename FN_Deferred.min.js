!function(t){function e(t,e){for(var n=t.length,s=-1;++s<n&&e.call(t,t[s],s)!==!1;);return t}var n=function(){return"undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof process?process.nextTick:function(t){t&&setTimeout(t,0)}}(),s=function(t,e,r,a){var u=this;this.id=a||null,r=isNaN(r)||r===!0?0:r;var i=[],o=[],f=[];this.state=s.state.PENDING,this.value=null,t&&i.push(t),e&&f.push(e),this.reject=function(t){return u.state>s.state.PENDING?u:(u.state=s.state.FAILURE,l.apply(this,arguments),u)},this.resolve=function(t){return u.state>s.state.PENDING?u:(u.state=s.state.SUCCESS,l.apply(this,arguments),u)},this.promise=function(t){return u},this.always=function(t){return"function"==typeof t&&(u.state!==s.state.PENDING&&n(t(u.value,u.isResolved())),o.push(t)),u},this.done=function(t){return"function"==typeof t&&(u.state===s.state.SUCCESS&&n(t(u.value,!0)),i.push(t)),u},this.then=function(t,e){return u.done(t),u.fail(e),u},u.fail=function(t){return"function"==typeof t&&(u.state===s.state.FAILURE&&n(t(u.value,!1)),f.push(t)),u},this["catch"]=this.fail,this.isRejected=function(){return u.state===s.state.FAILURE},this.isResolved=function(){return u.state===s.state.SUCCESS},this.status=function(){var t=u.state,e=s.status[t];return e};var c=!0,l=function(t){var e=this;if(u.state===s.state.PENDING)return u;u.value=arguments;var n=function(t){try{t.apply(e,u.value)}catch(n){console.warn("Deferred callback Failed for state - "+u.status()+": "+n.message),c&&(c=!1,u.state=s.state.FAILURE,l({errorType:"deferred_callback_error",error:n,message:"An Error occured in this function: "+t.toString()}))}};return u.state===s.state.SUCCESS?i.map(n):u.state===s.state.FAILURE&&f.map(n),o.map(n),u};r&&window.setTimeout(function(){u.state===s.state.PENDING&&u.reject({errorType:"deferred_timed_out"})},r)};s.state={PENDING:0,FAILURE:1,SUCCESS:2},s.status=["pending","rejected","resolved"],s.when=function(){var t,n=0,r=new s,a=[].slice.call(arguments),u=null;return a[0]instanceof Array&&(a=a[0]),"function"==typeof arguments[1]&&(u=arguments[1]),t=a.length,0===t?r.resolve(null):e(a,function(e){e.then(function(){++n!==t||r.isResolved()||(a.length>1?(r.resolve(a.map(function(t){return t.value})),u&&u(a.map(function(t){return t.value}))):(r.resolve(a[0].value),u&&u(a[0].value)))},function(){r.isResolved()||(a.length>1?(r.reject(a.map(function(t){return t.value})),u&&u(a.map(function(t){return t.value}))):(r.reject(a[0].value),u&&u(a[0].value)))})}),r},"undefined"!=typeof exports?module.exports=s:"function"==typeof define&&define.amd?define("Deferred",[],function(){return s}):"function"==typeof define?define("Deferred",s):window.Deferred=s}(this);