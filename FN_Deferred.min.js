!function(t){function e(t,e){for(var n=t.length,s=-1;++s<n&&e.call(t,t[s],s)!==!1;);return t}var n=function(){return"undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof process?process.nextTick:function(t){t&&setTimeout(t,0)}}(),s=function(t,e,r,a){var i=this;this.id=a||null,r=isNaN(r)||r===!0?0:r;var u=[],o=[],f=[];this.state=s.state.PENDING,this.value=null,t&&u.push(t),e&&f.push(e),this.reject=function(t){return i.state>s.state.PENDING?i:(i.state=s.state.FAILURE,l.apply(this,arguments),i)},this.resolve=function(t){return i.state>s.state.PENDING?i:(i.state=s.state.SUCCESS,l.apply(this,arguments),i)},this.promise=function(t){return i},this.always=function(t){return"function"==typeof t&&(i.state!==s.state.PENDING&&n(t.apply(this,i.value)),o.push(t)),i},this.done=function(t){return"function"==typeof t&&(i.state===s.state.SUCCESS&&n(t.apply(this,i.value)),u.push(t)),i},this.then=function(t,e){return i.done(t),i.fail(e),i},i.fail=function(t){return"function"==typeof t&&(i.state===s.state.FAILURE&&n(t.apply(this,i.value)),f.push(t)),i},this["catch"]=this.fail,this.isRejected=function(){return i.state===s.state.FAILURE},this.isResolved=function(){return i.state===s.state.SUCCESS},this.status=function(){var t=i.state,e=s.status[t];return e};var c=!0,l=function(t){if(i.state===s.state.PENDING)return i;i.value=arguments;var e=function(t,e,n){var r=0;try{var a=t.length;for(r=0;a>r;r++)t[r].apply(e,n)}catch(u){console.warn("Deferred callback Failed for state - "+i.status()+": "+u.message),c&&(c=!1,i.state=s.state.FAILURE,l({errorType:"deferred_callback_error",error:u,message:"An Error occured in this function: "+t[r].toString()}))}};return i.state===s.state.SUCCESS?e(u,this,arguments):i.state===s.state.FAILURE&&e(f,this,arguments),e(o,this,arguments),i};r&&window.setTimeout(function(){i.state===s.state.PENDING&&i.reject({errorType:"deferred_timed_out"})},r)};s.state={PENDING:0,FAILURE:1,SUCCESS:2},s.status=["pending","rejected","resolved"],s.when=function(){var t,n=0,r=new s,a=[].slice.call(arguments),i=null;return a[0]instanceof Array&&(a=a[0]),"function"==typeof arguments[1]&&(i=arguments[1]),t=a.length,0===t?r.resolve(null):e(a,function(e){e.then(function(){++n!==t||r.isResolved()||(r.resolve.apply(this,a),i&&i.apply(this,a))},function(){r.isResolved()||(r.reject.apply(this,a),i&&i.apply(this,a))})}),r},"undefined"!=typeof exports?module.exports=s:"function"==typeof define&&define.amd?define("Deferred",[],function(){return s}):"function"==typeof define?define("Deferred",s):window.Deferred=s}(this);